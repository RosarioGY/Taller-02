<mxfile host="drawio-plugin" modified="2025-09-11T00:00:00.000Z" agent="Mozilla/5.0" version="24.7.1">
  <!-- ===================== PAGE 4: Flowchart (Rules & Pipeline) ===================== -->
  <diagram id="c4" name="C4 - Flowchart (Rules & Pipeline)">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Externo -->
        <mxCell id="C" value="Cliente - Postman / App" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="200" height="60" as="geometry"/>
        </mxCell>

        <!-- Contenedor principal del servicio -->
        <mxCell id="SVC" value="loan-validation - Spring Boot WebFlux" style="swimlane;rounded=1;html=1;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="40" width="700" height="520" as="geometry"/>
        </mxCell>

        <!-- Controller y Service -->
        <mxCell id="CTRL" value="Controller - LoanValidationsController" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="40" y="40" width="260" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="SRV" value="Service - LoanRulesService" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="330" y="40" width="260" height="50" as="geometry"/>
        </mxCell>

        <!-- Subgrafo RULES -->
        <mxCell id="RULES" value="Business Rules" style="swimlane;rounded=1;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="40" y="120" width="480" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="R4" value="R4: Datos válidos" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="RULES">
          <mxGeometry x="20" y="20" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="R1" value="R1: Antigüedad &lt; 3m" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="RULES">
          <mxGeometry x="20" y="80" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="R2" value="R2: Plazo 1..36" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="RULES">
          <mxGeometry x="20" y="140" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="R3" value="R3: Capacidad ≤ 40% sueldo" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="RULES">
          <mxGeometry x="260" y="80" width="200" height="40" as="geometry"/>
        </mxCell>

        <!-- monthlyPayment -->
        <mxCell id="MP" value="monthlyPayment = requestedAmount / termMonths" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="540" y="170" width="220" height="60" as="geometry"/>
        </mxCell>

        <!-- Subgrafo CONTRACT -->
        <mxCell id="CONTRACT" value="Contract-first" style="swimlane;rounded=1;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="540" y="250" width="220" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="OA" value="OpenAPI YAML&#10;src/main/resources/openapi/loan-validation.yaml" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="CONTRACT">
          <mxGeometry x="20" y="20" width="180" height="48" as="geometry"/>
        </mxCell>
        <mxCell id="GEN" value="openapi-generator&#10;mvn generate-sources" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="CONTRACT">
          <mxGeometry x="20" y="80" width="180" height="48" as="geometry"/>
        </mxCell>
        <mxCell id="MDL" value="Modelos DTO&#10;(LoanValidationRequest/Result)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="CONTRACT">
          <mxGeometry x="20" y="130" width="180" height="28" as="geometry"/>
        </mxCell>

        <!-- Subgrafo QA -->
        <mxCell id="QA" value="Quality" style="swimlane;rounded=1;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="40" y="360" width="480" height="140" as="geometry"/>
        </mxCell>
        <mxCell id="TST" value="JUnit/Mockito&#10;src/test" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="QA">
          <mxGeometry x="20" y="20" width="130" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="JACO" value="JaCoCo coverage" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="QA">
          <mxGeometry x="170" y="20" width="130" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="CS" value="Checkstyle verify" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="QA">
          <mxGeometry x="320" y="20" width="130" height="50" as="geometry"/>
        </mxCell>

        <!-- CFG -->
        <mxCell id="CFG" value="application.yml&#10;server.port=8080" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="SVC">
          <mxGeometry x="540" y="430" width="220" height="50" as="geometry"/>
        </mxCell>

        <!-- Nota -->
        <mxCell id="N1" value="Stateless (sin BD)&#10;Clock inyectable para tests" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1020" y="80" width="220" height="70" as="geometry"/>
        </mxCell>

        <!-- Arcos -->
        <mxCell id="E1" value="POST /loan-validations" style="endArrow=block;html=1;" edge="1" parent="1" source="C" target="CTRL">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E2" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="CTRL" target="SRV">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="E3" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="SRV" target="R4"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E4" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="SRV" target="R1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E5" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="SRV" target="R2"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E6" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="SRV" target="R3"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E7" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="SRV" target="MP"><mxGeometry relative="1" as="geometry"/></mxCell>

        <mxCell id="E8" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="OA" target="GEN"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E9" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="GEN" target="CTRL"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E10" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="GEN" target="MDL"><mxGeometry relative="1" as="geometry"/></mxCell>

        <mxCell id="E11" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="TST" target="JACO"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E12" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="TST" target="CTRL"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E13" value="" style="endArrow=block;html=1;" edge="1" parent="1" source="TST" target="SRV"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="E14" value="verifica estilo" style="endArrow=block;html=1;dashed=1;" edge="1" parent="1" source="CS" target="SVC"><mxGeometry relative="1" as="geometry"/></mxCell>

        <mxCell id="E15" value="" style="endArrow=none;dashed=1;html=1;" edge="1" parent="1" source="SVC" target="N1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
